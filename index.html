<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VitorApp</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .mobile-container {
            width: 375px;
            height: 750px; /* Aumentado el largo */
            background-color: white;
            border-radius: 30px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border: 10px solid #333;
        }

        .app-header {
            background-color: #4285f4;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-btn {
            color: white;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            display: none;
        }

        .screen {
            height: calc(100% - 60px);
            overflow-y: auto;
            padding: 20px;
            display: none;
        }

        .screen.active {
            display: block;
        }

        .menu-option {
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .menu-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .menu-option i {
            display: block;
            font-size: 40px;
            margin-bottom: 10px;
            color: #4285f4;
        }

        .menu-option .option-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .menu-option .option-desc {
            color: #666;
            font-size: 14px;
        }

        /* Login Form */
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .input-group {
            position: relative;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            outline: none;
        }

        .input-group input:focus {
            border-color: #4285f4;
        }

        button.login-btn {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button.login-btn:hover {
            background-color: #3367d6;
        }

        .error-message {
            color: #e53935;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }

        /* Device Linking */
        .device-list {
            margin-top: 20px;
        }

        .device-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .device-icon {
            background-color: #f5f5f5;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-size: 20px;
            color: #4285f4;
        }

        .device-info {
            flex-grow: 1;
        }

        .device-name {
            font-weight: bold;
        }

        .device-status {
            font-size: 12px;
            color: #666;
        }

        .add-device-btn {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 20px;
        }

        /* Safe Zone Map */
        #map {
            width: 100%;
            height: 300px;
            border-radius: 10px;
            margin-bottom: 20px;
            background-color: #e0e0e0;
            position: relative;
        }

        .map-placeholder {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: #666;
        }

        .radius-control {
            margin-top: 20px;
        }

        .radius-slider {
            width: 100%;
            margin-bottom: 10px;
        }

        .save-zone-btn {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 20px;
        }

        /* Navigation bar */
        .nav-bar {
            background-color: #f5f5f5;
            display: flex;
            justify-content: space-around;
            padding: 10px;
            position: absolute;
            bottom: 0;
            width: 100%;
            border-top: 1px solid #ddd;
        }

        .nav-item {
            padding: 5px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #666;
            font-size: 12px;
        }

        .nav-item.active {
            color: #4285f4;
        }

        .nav-item i {
            font-size: 24px;
            margin-bottom: 5px;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            width: 300px;
            max-width: 90%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }

        .modal-body {
            margin-bottom: 15px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-btn {
            padding: 10px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }

        .modal-btn-primary {
            background-color: #4285f4;
            color: white;
        }

        .modal-btn-secondary {
            background-color: #f5f5f5;
            color: #333;
        }

        /* Success Modal Animation */
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.5); }
            100% { opacity: 1; transform: scale(1 ); }
        }

        .success-icon {
            animation: fadeInScale 0.5s ease-out;
        }

        /* Estilo para pantalla de zonas guardadas */
        .zones-list {
            margin-top: 20px;
        }

        .zone-item {
            display: flex;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .zone-icon {
            background-color: rgba(66, 133, 244, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-size: 20px;
            color: #4285f4;
        }

        .zone-info {
            flex-grow: 1;
        }

        .zone-name {
            font-weight: bold;
        }

        .zone-details {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        /* Animaci√≥n de carga */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="mobile-container">
        <div class="app-header">
            <button class="back-btn"><i class="fas fa-arrow-left"></i></button>
            <span class="header-title">VitorApp</span>
            <span style="width: 24px;"></span>
        </div>

        <div id="main-menu" class="screen active">
            <div class="menu-option" id="login-option">
                <i class="fas fa-user-lock"></i>
                <div class="option-title">Inicio de Sesi√≥n</div>
                <div class="option-desc">Accede a tu cuenta de administrador</div>
            </div>

            <div class="menu-option" id="device-option">
                <i class="fas fa-mobile-alt"></i>
                <div class="option-title">Vincular Dispositivos</div>
                <div class="option-desc">Gestiona tus dispositivos conectados</div>
            </div>

            <div class="menu-option" id="safe-zone-option">
                <i class="fas fa-map-marker-alt"></i>
                <div class="option-title">Crear Zona Segura</div>
                <div class="option-desc">Establece √°reas de seguridad en el mapa</div>
            </div>

            <div class="menu-option" id="saved-zones-option">
                <i class="fas fa-list"></i>
                <div class="option-title">Mis Zonas Seguras</div>
                <div class="option-desc">Ver todas mis zonas guardadas</div>
            </div>
        </div>

        <div id="login-screen" class="screen">
            <h2 style="margin-bottom: 20px;">Inicio de Sesi√≥n</h2>
            <div class="login-form">
                <div class="input-group">
                    <input type="text" id="username" placeholder="Usuario">
                </div>
                <div class="input-group">
                    <input type="password" id="password" placeholder="Contrase√±a">
                </div>
                <div class="error-message" id="login-error">
                    Usuario o contrase√±a incorrectos. Int√©ntalo de nuevo.
                </div>
                <button class="login-btn" id="login-btn">Iniciar Sesi√≥n</button>
            </div>
        </div>

        <div id="device-screen" class="screen">
            <h2 style="margin-bottom: 20px;">Vincular Dispositivo</h2>
            <div id="linking-section">
                <p>Presiona el bot√≥n para generar un c√≥digo de vinculaci√≥n:</p>
                <button class="add-device-btn" id="generate-link-code">Generar C√≥digo</button>
                <div id="linking-status" style="margin-top: 20px; text-align: center; display: none;">
                    <div class="loading-spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 2s linear infinite; margin: 0 auto 10px;"></div>
                    <p>Cargando...</p>
                </div>
                <div id="link-code-display" style="margin-top: 20px ; text-align: center; font-size: 24px; font-weight: bold; display: none;">
                    <p>Ingrese este c√≥digo en el dispositivo del tutor:</p>
                    <span id="generated-code"></span>
                </div>
            </div>
            <h2 style="margin-top: 30px; margin-bottom: 20px;">Vincular Dispositivo por C√≥digo</h2>
            <div class="input-group" style="margin-bottom: 15px;">
                <input type="text" id="manual-code-input" placeholder="Ingrese el c√≥digo">
            </div>
            <button class="add-device-btn" id="enter-link-code">Ingresar C√≥digo</button>
            <h2 style="margin-top: 30px; margin-bottom: 20px;">Dispositivos Vinculados</h2>
            <div class="device-list" id="device-list">
                <div class="device-item">
                    <div class="device-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <div class="device-info">
                        <div class="device-name">iPhone 13</div>
                        <div class="device-status">Conectado</div>
                    </div>
                </div>
                <div class="device-item">
                    <div class="device-icon">
                        <i class="fas fa-tablet-alt"></i>
                    </div>
                    <div class="device-info">
                        <div class="device-name">iPad Pro</div>
                        <div class="device-status">Desconectado</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="safe-zone-screen" class="screen">
            <h2 style="margin-bottom: 20px;">Crear Zona Segura</h2>
            <div class="input-group" style="margin-bottom: 15px;">
                <input type="text" id="zone-name" placeholder="Nombre de la zona (opcional)">
            </div>
            <div id="map">
                <div class="map-placeholder">
                    <div class="map-marker"></div>
                    <div class="map-circle" id="radius-circle"></div>
                </div>
            </div>
            <div class="radius-control">
                <label for="radius-input">Radio de la zona (metros): <span id="radius-value">50</span></label>
                <input type="range" min="5" max="500" value="50" class="radius-slider" id="radius-input">
            </div>
            <div class="error-message" id="zone-error" style="margin-top: 10px;">
                Error: El radio debe ser de al menos 50 metros para ser efectivo.
            </div>
            <button class="save-zone-btn" id="save-zone-btn">Guardar Zona Segura</button>
        </div>

        <div id="saved-zones-screen" class="screen">
            <h2 style="margin-bottom: 20px;">Mis Zonas Seguras</h2>
            <div class="zones-list" id="zones-list">
            </div>
        </div>

        <div class="nav-bar">
            <div class="nav-item active" data-screen="main-menu">
                <i class="fas fa-home"></i>
                <span>Inicio</span>
            </div>
            <div class="nav-item" data-screen="login-screen">
                <i class="fas fa-user-lock"></i>
                <span>Sesi√≥n</span>
            </div>
            <div class="nav-item" data-screen="device-screen">
                <i class="fas fa-mobile-alt"></i>
                <span>Dispositivos</span>
            </div>
            <div class="nav-item" data-screen="safe-zone-screen">
                <i class="fas fa-map-marker-alt"></i>
                <span>Zonas</span>
            </div>
        </div>
    </div>

    <div id="add-device-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">A√±adir Nuevo Dispositivo</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group" style="margin-bottom: 15px;">
                    <input type="text" id="device-name" placeholder="Nombre del dispositivo">
                </div>
                <div class="input-group">
                    <select id="device-type" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;">
                        <option value="">Seleccionar tipo</option>
                        <option value="mobile">Tel √©fono m√≥vil</option>
                        <option value="tablet">Tablet</option>
                        <option value="watch">Reloj inteligente</option>
                        <option value="other">Otro</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="cancel-device">Cancelar</button>
                <button class="modal-btn modal-btn-primary" id="confirm-device">A√±adir</button>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variables
            const adminUser  = "admin";
            const adminPass = "admin";
            const MIN_RADIUS = 50; // Radio m√≠nimo en metros

            // Elementos DOM
            const backBtn = document.querySelector('.back-btn');
            const screens = document.querySelectorAll('.screen');
            const navItems = document.querySelectorAll('.nav-item');
            const menuOptions = document.querySelectorAll('.menu-option');
            const loginBtn = document.getElementById('login-btn');
            const radiusInput = document.getElementById('radius-input');
            const radiusValue = document.getElementById('radius-value');
            const radiusCircle = document.getElementById('radius-circle');
            const saveZoneBtn = document.getElementById('save-zone-btn');
            const zoneError = document.getElementById('zone-error');
            const addDeviceBtn = document.getElementById('add-device-btn');
            const addDeviceModal = document.getElementById('add-device-modal');
            const closeModal = document.querySelector('.close-modal');
            const cancelDevice = document.getElementById('cancel-device');
            const confirmDevice = document.getElementById('confirm-device');
            const deviceList = document.getElementById('device-list');
            const zonesList = document.getElementById('zones-list');
            const generateLinkCodeBtn = document.getElementById('generate-link-code');
            const linkingStatusDiv = document.getElementById('linking-status');
            const linkCodeDisplayDiv = document.getElementById('link-code-display');
            const generatedCodeSpan = document.getElementById('generated-code');
            const enterLinkCodeBtn = document.getElementById('enter-link-code');
            const manualCodeInput = document.getElementById('manual-code-input');

            // Ocultar mensaje de error de zona inicialmente
            zoneError.style.display = 'none';

            // Funci√≥n para cambiar de pantalla
            function showScreen(screenId) {
                screens.forEach(screen => {
                    screen.classList.remove('active');
                });

                document.getElementById(screenId).classList.add('active');

                // Actualizar t√≠tulo de la cabecera y bot√≥n de retroceso
                updateHeader(screenId);

                // Actualizar navegaci√≥n
                navItems.forEach(item => {
                    if (item.dataset.screen === screenId) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });

                // Cargar datos espec√≠ficos seg√∫n la pantalla
                if (screenId === 'saved-zones-screen') {
                    loadSavedZones();
                }
            }

            // Actualizar cabecera seg√∫n la pantalla
            function updateHeader(screenId) {
                const headerTitle = document.querySelector('.header-title');

                if (screenId === 'main-menu') {
                    headerTitle.textContent = 'VitorApp';
                    backBtn.style.display = 'none';
                } else if (screenId === 'login-screen') {
                    headerTitle.textContent = 'Inicio de Sesi√≥n';
                    backBtn.style.display = 'block';
                } else if (screenId === 'device-screen') {
                    headerTitle.textContent = 'Vincular Dispositivos';
                    backBtn.style.display = 'block';
                    // Ocultar c√≥digo y estado al entrar a la pantalla
                    linkingStatusDiv.style.display = 'none';
                    linkCodeDisplayDiv.style.display = 'none';
                    manualCodeInput.value = ''; // Limpiar el campo de c√≥digo manual
                } else if (screenId === 'safe-zone-screen') {
                    headerTitle.textContent = 'Crear Zona Segura';
                    backBtn.style.display = 'block';
                } else if (screenId === 'saved-zones-screen') {
                    headerTitle.textContent = 'Mis Zonas Seguras';
                    backBtn.style.display = 'block';
                }
            }

            // Event Listeners para opciones del men√∫ principal
            menuOptions.forEach(option => {
                option.addEventListener('click', function() {
                    if (this.id === 'login-option') {
                        showScreen('login-screen');
                    } else if (this.id === 'device-option') {
                        showScreen('device-screen');
                    } else if (this.id === 'safe-zone-option') {
                        showScreen('safe-zone-screen');
                    } else if (this.id === 'saved-zones-option') {
                        showScreen('saved-zones-screen');
                    }
                });
            });

            // Event Listener para bot√≥n de retroceso
            backBtn.addEventListener('click', function() {
                showScreen('main-menu');
            });

            // Event Listeners para items de navegaci√≥n
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    showScreen(this.dataset.screen);
                });
            });

            // Event Listener para inicio de sesi√≥n
            loginBtn.addEventListener('click', function() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const errorMsg = document.getElementById('login-error');

                if (username === adminUser  && password === adminPass) {
                    showConfirmationModal(
                        'Inicio de Sesi√≥n Exitoso',
                        'Bienvenido, administrador. Has iniciado sesi√≥n correctamente.',
                        'Continuar',
                        null,
                        function() {
                            document.getElementById('username').value = '';
                            document.getElementById('password').value = '';
                            errorMsg.style.display = 'none';
                            showScreen('main-menu');
                        }
                    );
                } else {
                    errorMsg.style.display = 'block';
                }
            });

            // Event Listener para control de radio en el mapa
            radiusInput.addEventListener('input', function() {
                const value = this.value;
                radiusValue.textContent = value;

                // Ocultar mensaje de error si es mayor que el m√≠nimo
                if (parseInt(value) >= MIN_RADIUS) {
                    zoneError.style.display = 'none';
                }

                // Actualizar el c√≠rculo en el mapa (simulaci√≥n)
                const size = value * 0.8; // Para visualizaci√≥n
                radiusCircle.style.width = size + 'px';
                radiusCircle.style.height = size + 'px';
            });

            // Event Listener para guardar zona segura
            saveZoneBtn.addEventListener('click', function() {
                const radius = parseInt(radiusInput.value);
                const zoneName = document.getElementById('zone-name').value || `Zona ${new Date().toLocaleDateString()}`;

                if (radius < MIN_RADIUS) {
                    // Mostrar error si el radio es menor al m√≠nimo
                    zoneError.style.display = 'block';
                } else {
                    // Guardar zona segura
                    const newZone = saveZone(zoneName, radius);

                    // Crear y mostrar el modal de confirmaci√≥n personalizado
                    showConfirmationModal(
                        'Zona Segura Guardada',
                        `Tu zona segura "${newZone.name}" ha sido guardada con √©xito con un radio de ${newZone.radius} metros.`,
                        'Volver al men√∫',
                        'Ver mis zonas',
                        function() {
                            // Resetear campos
                            document.getElementById('zone-name').value = '';
                            radiusInput.value = 50;
                            radiusValue.textContent = 50;
                            radiusCircle.style.width = '40px';
                            radiusCircle.style.height = '40px';
                            showScreen('main-menu');
                        },
                        function() {
                            // Resetear campos
                            document.getElementById('zone-name').value = '';
                            radiusInput.value = 50;
                            radiusValue.textContent = 50;
                            radiusCircle.style.width = '40px';
                            radiusCircle.style.height = '40px';
                            showScreen('saved-zones-screen');
                        }
                    );
                }
            });

            // Funci√≥n para crear y mostrar modal de confirmaci√≥n personalizado
            function showConfirmationModal(title, message, primaryBtnText, secondaryBtnText, primaryAction, secondaryAction) {
                // Crear el modal din√°micamente
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'flex';

                let secondaryButton = '';
                if (secondaryBtnText) {
                    secondaryButton = `<button class="modal-btn modal-btn-secondary" id="secondary-action">${secondaryBtnText}</button>`;
                }

                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">${title}</div>
                            <button class="close-modal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div style="text-align: center; margin: 15px 0;">
                                <i class="fas fa-check-circle success-icon" style="color: #4CAF50; font-size: 48px; margin-bottom: 15px;"></i>
                                <p>${message}</p>
                            </div>
                        </div>
                        <div class="modal-footer">
                            ${secondaryButton}
                            <button class="modal-btn modal-btn-primary" id="primary-action">${primaryBtnText}</button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal // Agregar event listeners
                modal.querySelector('.close-modal').addEventListener('click', function() {
                    document.body.removeChild(modal);
                });

                modal.querySelector('#primary-action').addEventListener('click', function() {
                    document.body.removeChild(modal);
                    if (primaryAction) primaryAction();
                });

                if (secondaryBtnText) {
                    modal.querySelector('#secondary-action').addEventListener('click', function() {
                        document.body.removeChild(modal);
                        if (secondaryAction) secondaryAction();
                    });
                }

                // Cerrar modal al hacer clic fuera
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
            }

            // Funci√≥n para guardar zona en localStorage
            function saveZone(name, radius) {
                // Obtener zonas existentes o inicializar array vac√≠o
                let savedZones = JSON.parse(localStorage.getItem('vitorapp_zones')) || [];

                // Crear nueva zona
                const newZone = {
                    id: Date.now(),
                    name: name,
                    radius: radius,
                    latitude: Math.random() * 0.1 + 40.4, // Simulaci√≥n de coordenadas
                    longitude: Math.random() * 0.1 - 3.7,
                    createdAt: new Date().toISOString()
                };

                // A√±adir a la lista y guardar
                savedZones.push(newZone);
                localStorage.setItem('vitorapp_zones', JSON.stringify(savedZones));

                return newZone;
            }

            // Funci√≥n para cargar zonas guardadas
            function loadSavedZones() {
                const savedZones = JSON.parse(localStorage.getItem('vitorapp_zones')) || [];
                zonesList.innerHTML = '';

                if (savedZones.length === 0) {
                    zonesList.innerHTML = '<p style="text-align: center; color: #666;">No tienes zonas seguras guardadas.</p>';
                    return;
                }

                savedZones.forEach(zone => {
                    const zoneItem = document.createElement('div');
                    zoneItem.className = 'zone-item';

                    const createdDate = new Date(zone.createdAt);
                    const formattedDate = createdDate.toLocaleDateString() + ' ' + createdDate.toLocaleTimeString();

                    zoneItem.innerHTML = `
                        <div class="zone-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="zone-info">
                            <div class="zone-name">${zone.name}</div>
                            <div class="zone-details">Radio: ${zone.radius} metros</div>
                            <div class="zone-details">Guardada: ${formattedDate}</div>
                        </div>
                    `;
                    zonesList.appendChild(zoneItem);
                });
            }

            // Funcionalidad para a√±adir dispositivo (modal)
            function openAddDeviceModal() {
                addDeviceModal.style.display = 'flex';
            }

            function closeAddDeviceModal() {
                addDeviceModal.style.display = 'none';
                document.getElementById('device-name').value = '';
                document.getElementById('device-type').value = '';
            }

            addDeviceBtn.addEventListener('click', openAddDeviceModal);
            closeModal.addEventListener('click', closeAddDeviceModal);
            cancelDevice.addEventListener('click', closeAddDeviceModal);

            confirmDevice.addEventListener('click', function() {
                const deviceName = document.getElementById('device-name').value;
                const deviceType = document.getElementById('device-type').value;

                if (!deviceName || !deviceType) {
                    alert('Por favor, completa todos los campos.');
                    return;
                }

                // Crear nuevo elemento de dispositivo
                const newDevice = document.createElement('div');
                newDevice.className = 'device-item';

                let iconClass = 'fa-mobile-alt';
                if (deviceType === 'tablet') iconClass = 'fa-tablet-alt';
                if (deviceType === 'watch') iconClass = 'fa-clock';
                if (deviceType === 'other') iconClass = 'fa-laptop';

                newDevice.innerHTML = `
                    <div class="device-icon">
                        <i class="fas ${iconClass}"></i>
                    </div>
                    <div class="device-info">
                        <div class="device-name">${deviceName}</div>
                        <div class="device-status">Conectando...</div>
                    </div>
                `;

                // A√±adir a la lista
                deviceList.appendChild(newDevice);

                // Cerrar el modal
                closeAddDeviceModal();

                // Simular conexi√≥n despu√©s de 2 segundos
                setTimeout(() => {
                    const statusElement = newDevice.querySelector('.device-status');
                    statusElement.textContent = 'Conectado';
                    statusElement.style.color = '#4caf50';
                }, 2000);
            });

            // Event Listener para el bot√≥n "Ingresar C√≥digo"
            enterLinkCodeBtn.addEventListener('click', function() {
                const enteredCode = manualCodeInput.value;
                if (enteredCode) {
                    console.log("C√≥digo ingresado:", enteredCode);
                    // Simulaci√≥n de vinculaci√≥n exitosa
                    showConfirmationModal(
                        'Dispositivo Vinculado',
                        `El dispositivo con c√≥digo "${enteredCode}" se ha vinculado correctamente.`,
                        'Aceptar',
                        null,
                        function() {
                            // Aqu√≠ podr√≠as agregar la l√≥gica para mostrar el nuevo dispositivo en la lista
                            const newDeviceName = prompt("Ingrese el nombre del dispositivo vinculado:");
                            if (newDeviceName) {
                                addDeviceToList(newDeviceName, 'C√≥digo Ingresado');
                            }
                            manualCodeInput.value = ''; // Limpiar el campo despu√©s de intentar
                        }
                    );
                } else {
                    alert("Por favor, ingrese un c√≥digo.");
                }
            });

            // Event Listener para el bot√≥n "Generar C√≥digo"
            generateLinkCodeBtn.addEventListener('click', function() {
                // Mostrar el estado de carga
                linkingStatusDiv.style.display = 'block';
                linkCodeDisplayDiv.style.display = 'none';

                // Generar c√≥digo aleatorio (ejemplo de 6 d√≠gitos)
                const code = Math.floor(100000 + Math.random() * 900000);
                console.log("C√≥digo generado:", code); // Para depuraci√≥n

                // Esperar 5 segundos
                setTimeout(function() {
                    // Ocultar el estado de carga
                    linkingStatusDiv.style.display = 'none';
                    // Mostrar el c√≥digo generado
                    generatedCodeSpan.textContent = code;
                    linkCodeDisplayDiv.style.display = 'block';
                }, 5000);
            });

            // Funci√≥n para a√±adir un dispositivo a la lista visualmente
            function addDeviceToList(deviceName, connectionMethod) {
                const newDevice = document.createElement('div');
                newDevice.className = 'device-item';
                newDevice.innerHTML = `
                    <div class="device-icon">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <div class="device-info">
                        <div class="device-name">${deviceName}</div>
                        <div class="device-status">Conectado (${connectionMethod})</div>
                    </div>
                `;
                deviceList.appendChild(newDevice);
            }

            // Inicializaci√≥n
            showScreen('main-menu');
        });
    </script>
</body>
</html>